<table class="table table-hover" id="test-sortable">
  <tbody>
    <% @subjects.each_with_index do |subject, index| %>
    <tr>
      <th><%= subject.title %></th>
      <th colspan="1", class="subject-title"></th>
    </tr>
    <% subject.tests.rank(:row_order).each do |test| %>
    <% if test.id.present? %>
    <tr data-index=<%= "#{index}" %> data-item-id=<%= "#{test.id}" %> data-project-id=<%= "#{@project.id}" %> class="item">
      <td><%= link_to test.title, test_path(test), class: "test-title" %></td>
      <td class="text-right">
        <%= link_to test.active, test_toggle_active_path(test), method: :patch, data: { confirm: 'Are you sure?' }, class: "btn btn-outline-danger btn-sm" %>
        <% if AnswerPaper.where(backed: false).present? || Testing.find_by(test_id: test.id).present? %>
        <%= link_to "answer", answer_papers_path(test: test), class: "btn btn-outline-info btn-sm" %>
        <% else %>
        <%= link_to 'index', test_test_questions_path(test), class: "btn btn-outline-info btn-sm" %>
        <button type="button" class="btn btn-outline-info btn-sm" data-toggle="modal" data-target="#modal<%= test.id %>">
          Edit
        </button>
        <div class="modal fade" id="modal<%= test.id %>" tabindex="-1" role="dialog" aria-labelledby="label1" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="label1">Modal title</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                <%= form_with(model: test, url: test_path(test), method: :put, local: true) do |form| %>
                <div class="form-group">
                  <%= form.text_field :title, placeholder: "input title", class: "form-control" %>
                  <%= form.select :subject_id, Subject.where(project_id: @project.id).map { |subject| [subject.title, subject.id] }, {}, class: "form-control mt-1" %>
                  <%= form.submit nil, class: "btn btn-info btn-sm mt-1"  %>
                </div>
              </div>
              <div class="modal-footer">
                <% end %>
                <button type="button" class="btn btn-info btn-sm" data-dismiss="modal">閉じる</button>
              </div>
            </div>
          </div>
        </div>
        <%= link_to 'Destroy', test_path(test), method: :delete, data: { confirm: 'Are you sure?' }, class: "btn btn-outline-info btn-sm" %>
        <% end %>
      </td>
    </tr>
    <% end %>
    <% end %>
    <% end %>
  </tbody>
</table>
